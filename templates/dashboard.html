{% extends "base.html" %}
{% block content %}
<div class="row g-3 mb-4">
  <div class="col-md-4">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Total Items</h5>
        <p class="display-6">{{ total_items }}</p>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Units in Stock</h5>
        <p class="display-6">{{ total_in_stock }}</p>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Low Stock</h5>
        <p class="display-6">{{ low_stock|length }}</p>
      </div>
    </div>
  </div>
</div>

<div class="row g-3 mb-4">
  <div class="col-md-6">
    <div class="card">
      <div class="card-header">Inventory by Category</div>
      <div class="card-body p-0">
        <table class="table mb-0">
          <thead><tr><th>Category</th><th>Items</th><th>Total Units</th></tr></thead>
          <tbody>
          {% for category, stats in stock_by_category %}
            <tr>
              <td><strong>{{ category }}</strong></td>
              <td>{{ stats.items }}</td>
              <td>{{ stats.total_units }}</td>
            </tr>
          {% else %}
            <tr><td colspan="3" class="text-center py-3">No inventory data available.</td></tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>Stock by Location</span>
        <a class="btn btn-sm btn-primary" href="{{ url_for('locations') }}">Manage Locations</a>
      </div>
      <div class="card-body p-0">
        <table class="table mb-0">
          <thead><tr><th>Location</th><th>Total Units</th><th></th></tr></thead>
          <tbody>
          {% for loc in locations %}
            <tr>
              <td><a href="{{ url_for('location_inventory', location_id=loc.id) }}">{{ loc.name }}</a></td>
              <td>{{ stock_by_location.get(loc.id, 0) }}</td>
              <td class="text-end">
                <a class="btn btn-sm btn-outline-primary" href="{{ url_for('location_inventory', location_id=loc.id) }}">View Inventory</a>
              </td>
            </tr>
          {% else %}
            <tr><td colspan="3" class="text-center py-3">No locations found.</td></tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<div class="row g-3">
  <div class="col-md-6">
    <div class="card">
      <div class="card-header">Low Stock Items</div>
      <div class="card-body p-0">
        <table class="table mb-0">
          <thead><tr><th>Item</th><th>Location</th><th>Stock</th><th>Min</th></tr></thead>
          <tbody>
          {% for item, location, stock in low_stock %}
            <tr>
              <td><a href="{{ url_for('item_edit', item_sku=item.sku) }}">{{ item.name }}</a></td>
              <td>{{ location.name }}</td>
              <td>{{ stock or 0 }} {{ item.unit }}</td>
              <td>{{ item.min_qty }}</td>
            </tr>
          {% else %}
            <tr><td colspan="4" class="text-center py-3">No low stock items.</td></tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card">
      <div class="card-header">Recent Transactions</div>
      <div class="card-body p-0">
        <table class="table mb-0">
          <thead><tr><th>When</th><th>Type</th><th>Item</th><th>Qty</th><th>Location</th><th>Distributor</th></tr></thead>
          <tbody>
          {% for t in recent %}
            <tr>
              <td>{{ t.created_at.strftime("%Y-%m-%d %H:%M") }}</td>
              <td>
                <span class="badge bg-{% if t.ttype == 'IN' %}success{% else %}danger{% endif %}">{{ t.ttype }}</span>
              </td>
              <td>{{ t.item.name }}</td>
              <td>{{ t.qty }} {{ t.item.unit }}</td>
              <td>{{ t.location.name if t.location else "—" }}</td>
              <td>{% if t.ttype == 'OUT' and t.distributor %}{{ t.distributor.name }}{% else %}—{% endif %}</td>
            </tr>
          {% else %}
            <tr><td colspan="6" class="text-center py-3">No transactions yet.</td></tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}

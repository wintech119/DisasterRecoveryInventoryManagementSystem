{% extends "base.html" %}
{% block content %}
<h3>{{ "Edit Item" if item else "New Item" }}</h3>
{% if item %}
<div class="alert alert-info mb-3">
  <strong>SKU:</strong> {{ item.sku }}
</div>
{% endif %}
<form method="post" enctype="multipart/form-data" class="mt-3">
  <div class="row g-3">
    <div class="col-md-6">
      <label class="form-label">Name *</label>
      <input class="form-control" name="name" required value="{{ item.name if item else "" }}">
    </div>
    <div class="col-md-3">
      <label class="form-label">Category</label>
      <input class="form-control" name="category" value="{{ item.category if item else "" }}">
    </div>
    <div class="col-md-3">
      <label class="form-label">Unit of Measure *</label>
      <select class="form-select" name="unit" required>
        <option value="">-- Select Unit --</option>
        <option value="pcs" {% if item and item.unit == "pcs" %}selected{% endif %}>pcs - Pieces</option>
        <option value="set" {% if item and item.unit == "set" %}selected{% endif %}>set - Set</option>
        <option value="box" {% if item and item.unit == "box" %}selected{% endif %}>box - Box</option>
        <option value="pack" {% if item and item.unit == "pack" %}selected{% endif %}>pack - Pack</option>
        <option value="bag" {% if item and item.unit == "bag" %}selected{% endif %}>bag - Bag</option>
        <option value="kg" {% if item and item.unit == "kg" %}selected{% endif %}>kg - Kilogram</option>
        <option value="g" {% if item and item.unit == "g" %}selected{% endif %}>g - Grams</option>
        <option value="L" {% if item and item.unit == "L" %}selected{% endif %}>L - Litres</option>
        <option value="ml" {% if item and item.unit == "ml" %}selected{% endif %}>ml - Millilitres</option>
        <option value="tin" {% if item and item.unit == "tin" %}selected{% endif %}>tin - Tin/Can</option>
        <option value="bottle" {% if item and item.unit == "bottle" %}selected{% endif %}>bottle - Bottle</option>
        <option value="roll" {% if item and item.unit == "roll" %}selected{% endif %}>roll - Roll</option>
        <option value="tube" {% if item and item.unit == "tube" %}selected{% endif %}>tube - Tube</option>
        <option value="pkt" {% if item and item.unit == "pkt" %}selected{% endif %}>pkt - Packet</option>
        <option value="kit" {% if item and item.unit == "kit" %}selected{% endif %}>kit - Kit</option>
      </select>
      <small class="text-muted">Select the appropriate unit for this item</small>
    </div>
    <div class="col-md-3">
      <label class="form-label">Min Qty</label>
      <input class="form-control" type="number" name="min_qty" value="{{ item.min_qty if item else 0 }}">
    </div>
    <div class="col-md-3">
      <label class="form-label">Expiry Date</label>
      <input class="form-control" type="date" name="expiry_date" value="{{ item.expiry_date.isoformat() if item and item.expiry_date else "" }}">
      <small class="text-muted">For perishable items</small>
    </div>
    <div class="col-12">
      <label class="form-label">Storage Requirements</label>
      <select class="form-select" name="storage_requirements">
        <option value="">-- Select Storage Requirement --</option>
        <option value="Store in a cool, dry place" {% if item and item.storage_requirements == "Store in a cool, dry place" %}selected{% endif %}>Store in a cool, dry place</option>
        <option value="Keep away from direct sunlight" {% if item and item.storage_requirements == "Keep away from direct sunlight" %}selected{% endif %}>Keep away from direct sunlight</option>
        <option value="Keep off the floor (use pallets or shelves)" {% if item and item.storage_requirements == "Keep off the floor (use pallets or shelves)" %}selected{% endif %}>Keep off the floor (use pallets or shelves)</option>
        <option value="Keep sealed to prevent contamination" {% if item and item.storage_requirements == "Keep sealed to prevent contamination" %}selected{% endif %}>Keep sealed to prevent contamination</option>
        <option value="Store separately from chemicals" {% if item and item.storage_requirements == "Store separately from chemicals" %}selected{% endif %}>Store separately from chemicals</option>
        <option value="Use First-In, First-Out (FIFO) rotation" {% if item and item.storage_requirements == "Use First-In, First-Out (FIFO) rotation" %}selected{% endif %}>Use First-In, First-Out (FIFO) rotation</option>
        <option value="Maintain temperature-controlled storage" {% if item and item.storage_requirements == "Maintain temperature-controlled storage" %}selected{% endif %}>Maintain temperature-controlled storage</option>
        <option value="Keep in original packaging" {% if item and item.storage_requirements == "Keep in original packaging" %}selected{% endif %}>Keep in original packaging</option>
        <option value="Store in pest-free area" {% if item and item.storage_requirements == "Store in pest-free area" %}selected{% endif %}>Store in pest-free area</option>
        <option value="Separate by category (food, medical, hygiene, etc.)" {% if item and item.storage_requirements == "Separate by category (food, medical, hygiene, etc.)" %}selected{% endif %}>Separate by category (food, medical, hygiene, etc.)</option>
        <option value="Limit access to authorized personnel" {% if item and item.storage_requirements == "Limit access to authorized personnel" %}selected{% endif %}>Limit access to authorized personnel</option>
        <option value="Monitor expiry dates regularly" {% if item and item.storage_requirements == "Monitor expiry dates regularly" %}selected{% endif %}>Monitor expiry dates regularly</option>
        <option value="Ensure proper ventilation in storage area" {% if item and item.storage_requirements == "Ensure proper ventilation in storage area" %}selected{% endif %}>Ensure proper ventilation in storage area</option>
        <option value="No smoking or open flames near storage" {% if item and item.storage_requirements == "No smoking or open flames near storage" %}selected{% endif %}>No smoking or open flames near storage</option>
        <option value="Store flammable items in designated safety area" {% if item and item.storage_requirements == "Store flammable items in designated safety area" %}selected{% endif %}>Store flammable items in designated safety area</option>
        <option value="Label shelves and bins clearly" {% if item and item.storage_requirements == "Label shelves and bins clearly" %}selected{% endif %}>Label shelves and bins clearly</option>
        <option value="Protect items from moisture" {% if item and item.storage_requirements == "Protect items from moisture" %}selected{% endif %}>Protect items from moisture</option>
        <option value="Do not stack excessively to prevent damage" {% if item and item.storage_requirements == "Do not stack excessively to prevent damage" %}selected{% endif %}>Do not stack excessively to prevent damage</option>
        <option value="Keep fragile items on upper racks" {% if item and item.storage_requirements == "Keep fragile items on upper racks" %}selected{% endif %}>Keep fragile items on upper racks</option>
        <option value="Ensure easy access for audits and distribution" {% if item and item.storage_requirements == "Ensure easy access for audits and distribution" %}selected{% endif %}>Ensure easy access for audits and distribution</option>
      </select>
      <small class="text-muted">Select the primary storage requirement for this item</small>
    </div>
    <div class="col-12">
      <label class="form-label">Description</label>
      <textarea class="form-control" name="description" rows="3" placeholder="Optional description or notes about this item">{{ item.description if item else "" }}</textarea>
    </div>
    <div class="col-12">
      <label class="form-label"><i class="bi bi-paperclip"></i> Attachment (Optional)</label>
      {% if item and item.attachment_filename %}
      <div class="alert alert-info py-2 mb-2">
        <i class="bi bi-file-earmark"></i> <strong>Current file:</strong> {{ item.attachment_filename }}
        <a href="{{ url_for('serve_upload', file_path=item.attachment_path) }}" class="btn btn-sm btn-outline-primary ms-2" target="_blank">
          <i class="bi bi-download"></i> View/Download
        </a>
      </div>
      {% endif %}
      <input class="form-control" type="file" name="attachment" accept=".png,.jpg,.jpeg,.gif,.pdf,.doc,.docx,.txt,.csv,.xlsx">
      <small class="text-muted">Upload images, PDFs, or documents (max 10MB). Supported: PNG, JPG, PDF, DOC, DOCX, TXT, CSV, XLSX</small>
    </div>
  </div>
  <div class="mt-3">
    <button class="btn btn-primary">Save</button>
    <a class="btn btn-secondary" href="{{ url_for('items') }}">Cancel</a>
  </div>
  {% if not item %}
  <small class="text-muted">Note: SKU will be automatically generated when you save this item.</small>
  {% endif %}
</form>
{% endblock %}

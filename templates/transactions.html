{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h3><i class="bi bi-list-ul me-2"></i>Transaction History</h3>
  <small class="text-muted">Showing last 500 transactions</small>
</div>

<div class="card">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th>
              <a href="{{ url_for('transactions', sort_by='created_at', order='asc' if sort_by == 'created_at' and order == 'desc' else 'desc') }}" class="text-decoration-none text-dark">
                When
                {% if sort_by == 'created_at' %}
                  <i class="bi bi-arrow-{% if order == 'asc' %}up{% else %}down{% endif %}"></i>
                {% endif %}
              </a>
            </th>
            <th>
              <a href="{{ url_for('transactions', sort_by='type', order='asc' if sort_by == 'type' and order == 'desc' else 'desc') }}" class="text-decoration-none text-dark">
                Type
                {% if sort_by == 'type' %}
                  <i class="bi bi-arrow-{% if order == 'asc' %}up{% else %}down{% endif %}"></i>
                {% endif %}
              </a>
            </th>
            <th>
              <a href="{{ url_for('transactions', sort_by='item', order='asc' if sort_by == 'item' and order == 'desc' else 'desc') }}" class="text-decoration-none text-dark">
                Item
                {% if sort_by == 'item' %}
                  <i class="bi bi-arrow-{% if order == 'asc' %}up{% else %}down{% endif %}"></i>
                {% endif %}
              </a>
            </th>
            <th>
              <a href="{{ url_for('transactions', sort_by='qty', order='asc' if sort_by == 'qty' and order == 'desc' else 'desc') }}" class="text-decoration-none text-dark">
                Qty
                {% if sort_by == 'qty' %}
                  <i class="bi bi-arrow-{% if order == 'asc' %}up{% else %}down{% endif %}"></i>
                {% endif %}
              </a>
            </th>
            <th>Unit</th>
            <th>
              <a href="{{ url_for('transactions', sort_by='depot', order='asc' if sort_by == 'depot' and order == 'desc' else 'desc') }}" class="text-decoration-none text-dark">
                Depot
                {% if sort_by == 'depot' %}
                  <i class="bi bi-arrow-{% if order == 'asc' %}up{% else %}down{% endif %}"></i>
                {% endif %}
              </a>
            </th>
            <th>Donor</th>
            <th>Beneficiary</th>
            <th>Distributor</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody>
        {% for t in rows %}
          <tr>
            <td><small>{{ t.created_at.strftime("%Y-%m-%d %H:%M") }}</small></td>
            <td>
              <span class="badge bg-{% if t.ttype == 'IN' %}success{% else %}danger{% endif %}">{{ t.ttype }}</span>
            </td>
            <td>{{ t.item.name }}</td>
            <td>{{ t.qty }}</td>
            <td>{{ t.item.unit }}</td>
            <td>{{ t.depot.name if t.depot else "—" }}</td>
            <td>{{ t.donor.name if t.donor else "—" }}</td>
            <td>{{ t.beneficiary.name if t.beneficiary else "—" }}</td>
            <td>{{ t.distributor.name if t.distributor else "—" }}</td>
            <td><small>{{ t.notes or "" }}</small></td>
          </tr>
        {% else %}
          <tr><td colspan="10" class="text-center py-3 text-muted">No transactions yet.</td></tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
